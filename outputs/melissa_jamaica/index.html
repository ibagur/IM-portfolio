<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hurricane Melissa - Affected Communities in Jamaica</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
        .info-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            max-width: 320px;
        }
        .info-panel h2 {
            margin: 0 0 15px 0;
            font-size: 20px;
            color: #c62828;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .info-panel h3 {
            margin: 15px 0 8px 0;
            font-size: 14px;
            color: #424242;
            font-weight: 600;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 5px;
        }
        .info-panel p {
            margin: 5px 0;
            font-size: 13px;
            color: #616161;
            line-height: 1.5;
        }
        .stat-highlight {
            background: #fff3e0;
            padding: 8px 12px;
            border-radius: 6px;
            margin: 10px 0;
            border-left: 4px solid #ff6f00;
        }
        .stat-highlight strong {
            color: #e65100;
            font-size: 15px;
        }
        .legend {
            position: absolute;
            bottom: 30px;
            right: 10px;
            background: white;
            padding: 18px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 1000;
        }
        .legend h4 {
            margin: 0 0 12px 0;
            font-size: 14px;
            font-weight: 600;
            color: #424242;
        }
        .legend-item {
            margin: 8px 0;
            display: flex;
            align-items: center;
            font-size: 12px;
            color: #616161;
        }
        .legend-circle {
            display: inline-block;
            border-radius: 50%;
            margin-right: 10px;
            flex-shrink: 0;
        }
        .legend-circle.official {
            border: 2px solid #c62828;
            background: rgba(198, 40, 40, 0.35);
        }
        .legend-circle.estimated {
            border: 2px solid #f57c00;
            background: rgba(245, 124, 0, 0.35);
        }
        .popup-content {
            font-size: 13px;
            min-width: 200px;
        }
        .popup-content strong {
            color: #c62828;
            font-size: 16px;
            display: block;
            margin-bottom: 8px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 5px;
        }
        .popup-content .customers {
            font-size: 18px;
            font-weight: bold;
            color: #1565c0;
            margin: 8px 0;
            padding: 8px;
            background: #e3f2fd;
            border-radius: 5px;
            text-align: center;
        }
        .popup-content .detail-row {
            margin: 6px 0;
            display: flex;
            gap: 5px;
        }
        .popup-content .label {
            font-weight: 600;
            color: #424242;
        }
        .popup-content .value {
            color: #616161;
        }
        .popup-content .coord-source {
            font-size: 11px;
            color: #757575;
            font-style: italic;
            margin-top: 8px;
            padding-top: 6px;
            border-top: 1px solid #e0e0e0;
        }
        .community-label {
            font-size: 11px;
            font-weight: bold;
            color: #1a237e;
            text-shadow: 
                -1px -1px 0 #fff,  
                1px -1px 0 #fff,
                -1px 1px 0 #fff,
                1px 1px 0 #fff,
                2px 2px 3px rgba(0,0,0,0.3);
            white-space: nowrap;
            pointer-events: none;
        }
        .note-box {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 6px;
            margin-top: 12px;
            border-left: 4px solid #4caf50;
            font-size: 11px;
            color: #616161;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <div class="info-panel">
        <h2>ðŸŒ€ Hurricane Melissa</h2>
        <h3>Impact Overview</h3>
        <div class="stat-highlight">
            <strong>17 communities</strong> mapped<br>
            <strong>8,811 customers</strong> affected
        </div>
        
        <h3>Distribution by Parish</h3>
        <p>
            <strong>Westmoreland:</strong> 10 communities<br>
            <strong>Saint Ann:</strong> 1 community<br>
            <strong>Saint Elizabeth:</strong> 1 community<br>
            <strong>Saint James:</strong> 1 community<br>
            <strong>Estimated locations:</strong> 5 communities
        </p>
        
        <div class="note-box">
            <strong>âœ“ Complete Coverage:</strong> All 17 communities now have coordinate data
        </div>
    </div>
    
    <div class="legend">
        <h4>ðŸ“Š Bubble Size = Customers</h4>
        <div class="legend-item">
            <span class="legend-circle official" style="width: 32px; height: 32px;"></span>
            <span>1,500+ customers</span>
        </div>
        <div class="legend-item">
            <span class="legend-circle official" style="width: 22px; height: 22px;"></span>
            <span>500-1,500 customers</span>
        </div>
        <div class="legend-item">
            <span class="legend-circle official" style="width: 14px; height: 14px;"></span>
            <span>100-500 customers</span>
        </div>
        <div class="legend-item">
            <span class="legend-circle official" style="width: 9px; height: 9px;"></span>
            <span>&lt;100 customers</span>
        </div>
        <div style="margin-top: 12px; padding-top: 10px; border-top: 1px solid #e0e0e0; font-size: 11px;">
            <div style="margin: 5px 0;"><span class="legend-circle official" style="width: 12px; height: 12px; display: inline-block;"></span> Official ADM3 location</div>
            <div style="margin: 5px 0;"><span class="legend-circle estimated" style="width: 12px; height: 12px; display: inline-block;"></span> Estimated location</div>
        </div>
    </div>

    <script>
        // Initialize map centered on western Jamaica
        var map = L.map('map').setView([18.25, -78.0], 10);

        // Add tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors',
            maxZoom: 18,
            minZoom: 8
        }).addTo(map);

        // Communities data with actual coordinates
        var communities = [
        {
                "name": "Grange Hill",
                "customers": 1988,
                "adm3": "Grange Hill",
                "adm2": "Grange Hill",
                "adm1": "Westmoreland",
                "adm3_pcode": "JM140605",
                "lat": 18.31062,
                "lon": -78.18431,
                "coord_source": "geoview.info",
                "has_adm3": true
        },
        {
                "name": "Whitehouse",
                "customers": 1260,
                "adm3": "Whitehouse",
                "adm2": "Whitehouse",
                "adm1": "Westmoreland",
                "adm3_pcode": "JM141410",
                "lat": 18.094397,
                "lon": -77.966727,
                "coord_source": "maptons.com",
                "has_adm3": true
        },
        {
                "name": "Darliston",
                "customers": 898,
                "adm3": "Darliston",
                "adm2": "Darliston",
                "adm1": "Westmoreland",
                "adm3_pcode": "JM140410",
                "lat": 18.234902,
                "lon": -77.975293,
                "coord_source": "maptons.com",
                "has_adm3": true
        },
        {
                "name": "Frome",
                "customers": 819,
                "adm3": "Frome",
                "adm2": "Grange Hill",
                "adm1": "Westmoreland",
                "adm3_pcode": "JM140602",
                "lat": 18.292711,
                "lon": -78.152168,
                "coord_source": "maptons.com",
                "has_adm3": true
        },
        {
                "name": "Whithorn",
                "customers": 723,
                "adm3": "Whithorn",
                "adm2": "Savanna-la-mar",
                "adm1": "Westmoreland",
                "adm3_pcode": "JM141321",
                "lat": 18.26582,
                "lon": -78.0253,
                "coord_source": "geoview.info",
                "has_adm3": true
        },
        {
                "name": "Bay Road",
                "customers": 500,
                "adm3": "Not in official dataset",
                "adm2": "-",
                "adm1": "-",
                "adm3_pcode": "N/A",
                "lat": 18.24402,
                "lon": -78.20773,
                "coord_source": "Little London centroid",
                "has_adm3": false
        },
        {
                "name": "Water Works",
                "customers": 467,
                "adm3": "Water Works",
                "adm2": "Savanna-la-mar",
                "adm1": "Westmoreland",
                "adm3_pcode": "JM141320",
                "lat": 18.24075006605744,
                "lon": -78.0480290079956,
                "coord_source": "ADM3 Centroid (Geodatabase)",
                "has_adm3": true
        },
        {
                "name": "Cave",
                "customers": 386,
                "adm3": "Cave Valley",
                "adm2": "Cave Valley",
                "adm1": "Saint Ann",
                "adm3_pcode": "JM070304",
                "lat": 18.23268,
                "lon": -77.36337,
                "coord_source": "satellite map",
                "has_adm3": true
        },
        {
                "name": "Burnt Savannah",
                "customers": 368,
                "adm3": "Burnt Savannah",
                "adm2": "Santa Cruz",
                "adm1": "Saint Elizabeth",
                "adm3_pcode": "JM090702",
                "lat": 18.3168,
                "lon": -78.1263,
                "coord_source": "getamap.net",
                "has_adm3": true
        },
        {
                "name": "Burnt Savannah",
                "customers": 368,
                "adm3": "Burnt Savannah",
                "adm2": "Santa Cruz",
                "adm1": "Saint Elizabeth",
                "adm3_pcode": "JM141201",
                "lat": 18.3168,
                "lon": -78.1263,
                "coord_source": "getamap.net",
                "has_adm3": true
        },
        {
                "name": "Broughton",
                "customers": 352,
                "adm3": "Broughton",
                "adm2": "Negril",
                "adm1": "Westmoreland",
                "adm3_pcode": "JM140901",
                "lat": 18.22010711044265,
                "lon": -78.21733923186311,
                "coord_source": "ADM3 Centroid (Geodatabase)",
                "has_adm3": true
        },
        {
                "name": "Albany",
                "customers": 322,
                "adm3": "Not in official dataset",
                "adm2": "-",
                "adm1": "-",
                "adm3_pcode": "N/A",
                "lat": 18.29183,
                "lon": -76.85663,
                "coord_source": "geoview.info",
                "has_adm3": false
        },
        {
                "name": "Top Road",
                "customers": 235,
                "adm3": "Not in official dataset",
                "adm2": "-",
                "adm1": "-",
                "adm3_pcode": "N/A",
                "lat": 18.24402,
                "lon": -78.20773,
                "coord_source": "Little London centroid",
                "has_adm3": false
        },
        {
                "name": "Belmont",
                "customers": 230,
                "adm3": "Belmont",
                "adm2": "Greater Montego Bay",
                "adm1": "Saint James",
                "adm3_pcode": "JM100503",
                "lat": 18.153564,
                "lon": -78.026674,
                "coord_source": "maptons.com",
                "has_adm3": true
        },
        {
                "name": "New Hope",
                "customers": 108,
                "adm3": "Not in official dataset",
                "adm2": "-",
                "adm1": "-",
                "adm3_pcode": "N/A",
                "lat": 18.103682,
                "lon": -77.975293,
                "coord_source": "maptons.com",
                "has_adm3": false
        },
        {
                "name": "Baulk",
                "customers": 80,
                "adm3": "Not in official dataset",
                "adm2": "-",
                "adm1": "-",
                "adm3_pcode": "N/A",
                "lat": 18.30643,
                "lon": -78.11128,
                "coord_source": "places-in-the-world.com",
                "has_adm3": false
        },
        {
                "name": "Ferris",
                "customers": 75,
                "adm3": "Ferris",
                "adm2": "Savanna-la-mar",
                "adm1": "Westmoreland",
                "adm3_pcode": "JM141305",
                "lat": 18.22663,
                "lon": -78.07156,
                "coord_source": "geoview.info",
                "has_adm3": true
        }
];

        // Function to calculate bubble radius based on customers
        function getRadius(customers) {
            return Math.sqrt(customers) * 1.8;
        }

        // Function to get color based on whether community has official ADM3
        function getColor(hasAdm3) {
            return hasAdm3 ? '#c62828' : '#f57c00';  // Red for official, Orange for estimated
        }

        // Add circles for each community
        communities.forEach(function(community) {
            var radius = getRadius(community.customers);
            var color = getColor(community.has_adm3);
            
            var circle = L.circle([community.lat, community.lon], {
                color: color,
                fillColor: color,
                fillOpacity: 0.35,
                radius: radius * 100,
                weight: 2.5
            }).addTo(map);

            // Create enhanced popup content
            var popupContent = '<div class="popup-content">' +
                '<strong>' + community.name + '</strong>' +
                '<div class="customers">' + community.customers.toLocaleString() + ' customers</div>';
            
            if (community.has_adm3) {
                popupContent += '<div class="detail-row"><span class="label">ADM3:</span><span class="value">' + community.adm3 + '</span></div>' +
                    '<div class="detail-row"><span class="label">ADM2:</span><span class="value">' + community.adm2 + '</span></div>' +
                    '<div class="detail-row"><span class="label">Parish:</span><span class="value">' + community.adm1 + '</span></div>' +
                    '<div class="detail-row"><span class="label">Code:</span><span class="value">' + community.adm3_pcode + '</span></div>';
            } else {
                popupContent += '<div class="detail-row"><span class="label">Status:</span><span class="value">Estimated location</span></div>' +
                    '<div class="detail-row"><span class="label">Note:</span><span class="value">No ADM3 match in dataset</span></div>';
            }
            
            popupContent += '<div class="coord-source">Coordinates: ' + community.coord_source + '</div></div>';

            circle.bindPopup(popupContent);

            // Add label for all communities
            var labelSize = community.customers > 800 ? '12px' : '10px';
            var label = L.marker([community.lat, community.lon], {
                icon: L.divIcon({
                    className: 'label',
                    html: '<div class="community-label" style="font-size: ' + labelSize + ';">' + 
                          community.name + '</div>',
                    iconSize: [120, 20]
                })
            }).addTo(map);

            // Hover effects
            circle.on('mouseover', function(e) {
                this.setStyle({
                    fillOpacity: 0.6,
                    weight: 3
                });
            });
            
            circle.on('mouseout', function(e) {
                this.setStyle({
                    fillOpacity: 0.35,
                    weight: 2.5
                });
            });
        });

        // Add a scale control
        L.control.scale({
            imperial: false,
            metric: true
        }).addTo(map);

        // Calculate and log statistics
        var totalCustomers = communities.reduce((sum, c) => sum + c.customers, 0);
        var withAdm3 = communities.filter(c => c.has_adm3).length;
        var withoutAdm3 = communities.filter(c => !c.has_adm3).length;
        
        console.log('Total customers affected:', totalCustomers);
        console.log('Total communities:', communities.length);
        console.log('Communities with ADM3:', withAdm3);
        console.log('Communities with estimated locations:', withoutAdm3);
        
        // Fit map to show all markers with padding
        var group = new L.featureGroup(map._layers);
        map.fitBounds(group.getBounds().pad(0.1));
    </script>
</body>
</html>